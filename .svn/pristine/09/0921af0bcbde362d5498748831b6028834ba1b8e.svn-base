//
//  SendMessageToWarningViewController.m
//  HYSEM
//
//  Created by Áéã‰∏ÄÊàê on 2017/6/20.
//  Copyright ¬© 2017Âπ¥ WGM. All rights reserved.
//

#import "SendMessageToWarningViewController.h"

#import "HYScoketManage.h"

@interface SendMessageToWarningViewController()<UITextViewDelegate>

@property (nonatomic,strong) UITextView * textView;
@property (nonatomic,strong) UILabel * placeLabel;
@property (nonatomic,strong) UILabel * personLabel;
//@property (nonatomic,strong)

@end

@implementation SendMessageToWarningViewController

- (void)viewDidLoad
{
    [super viewDidLoad];
    [self createNavigition];
    [self configUI];
    self.view.backgroundColor = [UIColor whiteColor];
}


- (void)createNavigition
{
    self.titleLabel.text = @"Áü≠‰ø°ÊèêÈÜí";
    [self.leftButton setImage:[UIImage imageNamed:@"back"] forState:UIControlStateNormal];
    [self setLeftButtonClick:@selector(leftButtonClick)];
    
}

#pragma mark - **************** ËøîÂõû‰∏ä‰∏ÄÁ∫ß
- (void)leftButtonClick
{
    [self.navigationController popViewControllerAnimated:YES];
}

- (void)configUI
{
    self.textView = [[UITextView alloc] initWithFrame:CGRectMake(5*ScreenMultiple, 5*ScreenMultiple, SCREEN_W-10*ScreenMultiple, 200*ScreenMultiple)];
    self.textView.delegate = self;
    self.textView.textColor = [UIColor blackColor];
    self.textView.textContainerInset = UIEdgeInsetsMake(25*ScreenMultiple, 25*ScreenMultiple, 25*ScreenMultiple, 25*ScreenMultiple);
    self.textView.font = [UIFont systemFontOfSize:18.f];
    self.textView.backgroundColor = [UIColor whiteColor];
    self.textView.layer.borderColor = [[UIColor grayColor] CGColor];
    self.textView.layer.borderWidth = 1;
    self.textView.text = @"üê∑üê∑Â∞äÊï¨ÁöÑÁî®Êà∑ÔºåÊÇ®ÁöÑË¥¶Êà∑‰ΩôÈ¢ùÂ∑≤‰∏çË∂≥ÔºåËØ∑ÂèäÊó∂Â§ÑÁêÜ„ÄÇ";
    self.textView.contentInset = UIEdgeInsetsMake(20*ScreenMultiple, 0, 0, 0);
    //Âç†‰Ωçlabel
    self.placeLabel = [[UILabel alloc] initWithFrame:CGRectMake(20*ScreenMultiple, 20*ScreenMultiple, SCREEN_W-10*ScreenMultiple, 40*ScreenMultiple)];
    self.placeLabel.text = @"ËæìÂÖ•Áõ∏ÂÖ≥‰ø°ÊÅØ";
//    [self.textView addSubview:self.placeLabel];
    [self.view addSubview:self.textView];
    [self addMessageP];
    [self addBtn];
}

#pragma mark - **************** delegate

-(void)textViewDidBeginEditing:(UITextView *)textView
{
    [self.textView becomeFirstResponder];
    self.placeLabel.alpha = 0;
}
-(void)textViewDidChange:(UITextView *)textView
{
    self.placeLabel.alpha = 0;
}
#pragma mark - **************** ËÅîÁ≥ª‰∫∫
- (void)addMessageP{
    _personLabel = [[UILabel alloc] initWithFrame:CGRectMake(0, -20, SCREEN_W, 40*ScreenMultiple)];
    _personLabel.backgroundColor = RGB(248, 248, 248);
    _personLabel.textColor = [UIColor blackColor];
    if (self.messageModel.messageArr.count > 0) {
        NSDictionary *attributeDict = [NSDictionary dictionaryWithObjectsAndKeys:
                                       [UIFont systemFontOfSize:15.0],NSFontAttributeName,
                                       RGB(172, 172, 175),NSForegroundColorAttributeName,
                                       nil];
        NSString * string = [NSString stringWithFormat:@" ËÅîÁ≥ª‰∫∫:  %@",self.messageModel.messageArr[0]];
        NSMutableAttributedString * AttString = [[NSMutableAttributedString alloc] initWithString:string];
        [AttString setAttributes:attributeDict range:NSMakeRange(0, 4)];
        _personLabel.attributedText = AttString;
    }else{
        _personLabel.text = @"ÊöÇÊó†ËÅîÁ≥ª‰ø°ÊÅØ";
    }
    _personLabel.textAlignment = NSTextAlignmentLeft;
    [self.textView addSubview:_personLabel];
}

#pragma mark -8**********ÂèñÊ∂àÁ°ÆËÆ§
-(void)addBtn{
    UIButton *btn = [[UIButton alloc]initWithFrame:CGRectMake(20*ScreenMultiple, CGRectGetMaxY(self.textView.frame) +10*ScreenMultiple, 110*ScreenMultiple, 30*ScreenMultiple)];
    btn.selected = YES;
    [btn setTitle:@"ÂèñÊ∂à" forState:UIControlStateNormal];
    btn.layer.cornerRadius = 5;
    [self.view addSubview:btn];
    [btn setBackgroundColor:[UIColor colorWithRed:255/255.0 green:102/255.0 blue:102/255.0 alpha:1.0]];
    [btn addTarget:self action:@selector(cancle:) forControlEvents:UIControlEventTouchUpInside];
    
    UIButton *btn1 = [[UIButton alloc]initWithFrame:CGRectMake(SCREEN_W - 20*ScreenMultiple-110*ScreenMultiple, 10*ScreenMultiple+CGRectGetMaxY(self.textView.frame), 110*ScreenMultiple, 30*ScreenMultiple)];
    [btn1 setTitle:@"Á°ÆËÆ§" forState:UIControlStateNormal];
    btn1.layer.cornerRadius = 5;
    [btn1 setBackgroundColor:[UIColor colorWithRed:46/255.0 green:149/255.0 blue:250/255.0 alpha:1.0]];
    [self.view addSubview:btn1];
    [btn1 addTarget:self action:@selector(commit) forControlEvents:UIControlEventTouchUpInside];
}

#pragma mark - **************** commot
- (void)commit
{
    if (_textView.text.length <= 0) {
        [UIView addMJNotifierWithText:@"‰ø°ÊÅØ‰∏çËÉΩ‰∏∫Á©∫" dismissAutomatically:YES];
        return;
    }
    if (self.messageModel.messageArr.count >0) {
        NSString * phoneNum = self.messageModel.messageArr[0];
        if (phoneNum.length == 11) {
            self.messageModel.messageLen = (int)_textView.text.length;
            self.messageModel.message = _textView.text;
            HYScoketManage * manager = [HYScoketManage shareManager];
            [manager getNetworkDatawithIP:SocketHOST withTag:@"message"];
            [manager writeMessageDataToHostWith:self.messageModel];

        }else{
            [UIView addMJNotifierWithText:@"Áü≠‰ø°Âè∑Á†ÅÊ†ºÂºè‰∏çÂØπ" dismissAutomatically:YES];
        }
    }else{
        [UIView addMJNotifierWithText:@"Ê≤°ÊúâËÅîÁ≥ªÊñπÂºè" dismissAutomatically:YES];
    }

}

-(void)cancle:(UIButton *)btn{
    [self.navigationController popViewControllerAnimated:YES];
}
@end
